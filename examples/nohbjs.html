<script>
var utf8Encoder = new TextEncoder("utf8");

// We could use instantiateStreaming but it's not supported in Safari yet
// https://bugs.webkit.org/show_bug.cgi?id=173105
fetch("../hb.wasm").then(function (x) {
  return x.arrayBuffer();
}).then(function (wasm) {
  return WebAssembly.instantiate(wasm);
}).then(function (result) {
  var exports = result.instance.exports;

  fetch('Roboto.abc.ttf').then(function (x) {
    return x.arrayBuffer();
  }).then(function (fontBlob) {
    var heapu8 = new Uint8Array(exports.memory.buffer);
    var heapu32 = new Uint32Array(exports.memory.buffer);
    var heapi32 = new Int32Array(exports.memory.buffer);

    var fontBuffer = exports.malloc(fontBlob.byteLength);
    heapu8.set(new Uint8Array(fontBlob), fontBuffer);

    var blob = exports.hb_blob_create(fontBuffer, fontBlob.byteLength, 2/*HB_MEMORY_MODE_WRITABLE*/, 0, 0);
    var face = exports.hb_face_create(blob, 0);
    var font = exports.hb_font_create(face);

    var buffer = exports.h